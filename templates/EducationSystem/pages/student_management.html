{% extends "EducationSystem/base.html" %} {% load static %} {% block content %}

<style>
  .container {
    max-width: 1800px;
    margin: 0 auto;
  }

  /* Login Styles */
  .login-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .login-box {
    background: white;
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    width: 100%;
    max-width: 400px;
  }

  .login-box h2 {
    text-align: center;
    margin-bottom: 30px;
    color: #333;
    font-size: 1.8rem;
  }

  .login-form .form-group {
    margin-bottom: 20px;
  }

  .login-form label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #444;
  }

  .login-form input {
    width: 100%;
    padding: 12px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s ease;
  }

  .login-form input:focus {
    outline: none;
    border-color: #007bff;
  }

  .login-btn {
    width: 100%;
    padding: 12px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .login-btn:hover {
    background-color: #0056b3;
  }

  .login-error {
    color: #dc3545;
    text-align: center;
    margin-top: 15px;
    font-weight: 600;
    display: none;
  }

  /* Main App Styles */
  .main-app {
    display: none;
  }

  .header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 30px;
    text-align: center;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    position: relative;
  }

  .logout-btn {
    position: absolute;
    left: 25px;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .logout-btn:hover {
    background: rgba(255, 255, 255, 0.3);
  }

  .header h1 {
    font-size: 2.2rem;
    margin-bottom: 10px;
  }

  .form-section {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
  }

  .form-section h2 {
    color: #333;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f0f0f0;
  }

  .form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #444;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s ease;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: #007bff;
  }

  .form-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    flex-wrap: wrap;
  }

  .btn {
    padding: 12px 30px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-primary {
    background-color: #007bff;
    color: white;
  }

  .btn-primary:hover {
    background-color: #0056b3;
  }

  .btn-secondary {
    background-color: #6c757d;
    color: white;
  }

  .btn-secondary:hover {
    background-color: #545b62;
  }

  .btn-danger {
    background-color: #dc3545;
    color: white;
  }

  .btn-danger:hover {
    background-color: #c82333;
  }

  .btn-warning {
    background-color: #ffc107;
    color: #212529;
  }

  .btn-warning:hover {
    background-color: #e0a800;
  }

  .table-section {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
  }

  .table-section h2 {
    color: #333;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid #f0f0f0;
  }

  .search-box {
    margin-bottom: 25px;
  }

  .search-box input {
    width: 100%;
    max-width: 400px;
    padding: 12px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 16px;
  }

  .table-container {
    overflow-x: auto;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    min-width: 1200px;
  }

  th,
  td {
    padding: 12px;
    text-align: right;
    border-bottom: 1px solid #e1e5e9;
    font-size: 14px;
  }

  th {
    background-color: #f8f9fa;
    font-weight: 700;
    color: #444;
    position: sticky;
    top: 0;
  }

  tr:hover {
    background-color: #f8f9fa;
  }

  .action-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .action-btn {
    padding: 6px 12px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
  }

  .message {
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-weight: 600;
  }

  .message.success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }

  .message.error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }

  .status-badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
  }

  .status-active {
    background: #d4edda;
    color: #155724;
  }
  .status-graduate {
    background: #fff3cd;
    color: #856404;
  }
  .status-dropout {
    background: #f8d7da;
    color: #721c24;
  }
  .status-expelled {
    background: #dc3545;
    color: white;
  }
  .status-guest {
    background: #d1ecf1;
    color: #0c5460;
  }
  .status-leave {
    background: #e2e3e5;
    color: #383d41;
  }
  .status-conditional {
    background: #ffeaa7;
    color: #856404;
  }
  .status-pending {
    background: #fff3cd;
    color: #856404;
  }

  @media (max-width: 768px) {
    .form-row {
      grid-template-columns: 1fr;
    }

    .form-actions {
      flex-direction: column;
    }

    .action-buttons {
      flex-direction: column;
    }

    .header h1 {
      font-size: 1.8rem;
    }

    .logout-btn {
      position: static;
      transform: none;
      margin-top: 15px;
    }
  }

  .hidden {
    display: none;
  }
</style>

<!-- Login Section -->
<div id="login-section" class="login-container">
  <div class="login-box">
    <h2>ورود به پنل مدیریت</h2>
    <form id="login-form" class="login-form">
      <div class="form-group">
        <label for="username">نام کاربری</label>
        <input
          type="text"
          id="username"
          placeholder="نام کاربری را وارد کنید"
          required
        />
      </div>
      <div class="form-group">
        <label for="password">رمز عبور</label>
        <input
          type="password"
          id="password"
          placeholder="رمز عبور را وارد کنید"
          required
        />
      </div>
      <button type="submit" class="login-btn">ورود به سیستم</button>
      <div id="login-error" class="login-error">
        نام کاربری یا رمز عبور اشتباه است
      </div>
    </form>
  </div>
</div>

<!-- Main Application -->
<div id="main-app" class="main-app">
  <div class="container">
    <div class="header">
      <button class="logout-btn" onclick="logout()">خروج از سیستم</button>
      <h1>پنل مدیریت دانشجویان</h1>
      <p>سیستم جامع مدیریت اطلاعات دانشجویی</p>
    </div>

    <div id="message-area"></div>

    <div class="form-section">
      <h2 id="form-title">فرم ثبت دانشجوی جدید</h2>
      <form id="student-form">
        <input type="hidden" id="student-id" />

        <!-- ردیف 1: اطلاعات پایه -->
        <div class="form-row">
          <div class="form-group">
            <label for="studentCode">شماره دانشجویی *</label>
            <input
              type="text"
              id="studentCode"
              required
              placeholder="مثال: 401234567"
            />
          </div>
          <div class="form-group">
            <label for="nationalId">کد ملی *</label>
            <input type="text" id="nationalId" required placeholder="10 رقمی" />
          </div>
          <div class="form-group">
            <label for="gender">جنسیت *</label>
            <select id="gender" required>
              <option value="">انتخاب کنید</option>
              <option value="مرد">مرد</option>
              <option value="زن">زن</option>
            </select>
          </div>
        </div>

        <!-- ردیف 2: اطلاعات شخصی -->
        <div class="form-row">
          <div class="form-group">
            <label for="firstName">نام *</label>
            <input type="text" id="firstName" required />
          </div>
          <div class="form-group">
            <label for="lastName">نام خانوادگی *</label>
            <input type="text" id="lastName" required />
          </div>
          <div class="form-group">
            <label for="fatherName">نام پدر *</label>
            <input type="text" id="fatherName" required />
          </div>
        </div>

        <!-- ردیف 3: اطلاعات تحصیلی -->
        <div class="form-row">
          <div class="form-group">
            <label for="major">رشته تحصیلی *</label>
            <select id="major" required>
              <option value="">انتخاب کنید</option>
              <option value="مهندسی کامپیوتر">مهندسی کامپیوتر</option>
              <option value="مهندسی برق">مهندسی برق</option>
              <option value="مهندسی مکانیک">مهندسی مکانیک</option>
              <option value="حقوق">حقوق</option>
              <option value="حسابداری">حسابداری</option>
              <option value="مدیریت">مدیریت</option>
            </select>
          </div>
          <div class="form-group">
            <label for="grade">مقطع تحصیلی *</label>
            <select id="grade" required>
              <option value="">انتخاب کنید</option>
              <option value="کاردانی پیوسته">کاردانی پیوسته</option>
              <option value="کارشناسی ناپیوسته">کارشناسی ناپیوسته</option>
              <option value="کارشناسی پیوسته">کارشناسی پیوسته</option>
              <option value="کارشناسی ارشد">کارشناسی ارشد</option>
              <option value="دکترا">دکترا</option>
            </select>
          </div>
          <div class="form-group">
            <label for="entryYear">سال ورود *</label>
            <select id="entryYear" required>
              <option value="">انتخاب کنید</option>
              <option value="1395">1395</option>
              <option value="1396">1396</option>
              <option value="1397">1397</option>
              <option value="1398">1398</option>
              <option value="1399">1399</option>
              <option value="1400">1400</option>
              <option value="1401">1401</option>
              <option value="1402">1402</option>
              <option value="1403">1403</option>
            </select>
          </div>
        </div>

        <!-- ردیف 4: اطلاعات تماس -->
        <div class="form-row">
          <div class="form-group">
            <label for="birthDate">تاریخ تولد *</label>
            <input
              type="text"
              id="birthDate"
              required
              placeholder="مثال: 1379/05/15"
            />
          </div>
          <div class="form-group">
            <label for="email">ایمیل</label>
            <input type="email" id="email" placeholder="example@domain.com" />
          </div>
          <div class="form-group">
            <label for="phone">شماره تلفن *</label>
            <input type="tel" id="phone" required placeholder="09xxxxxxxxx" />
          </div>
        </div>

        <!-- ردیف 5: اطلاعات تکمیلی -->
        <div class="form-row">
          <div class="form-group">
            <label for="maritalStatus">وضعیت تاهل</label>
            <select id="maritalStatus">
              <option value="مجرد">مجرد</option>
              <option value="متاهل">متاهل</option>
            </select>
          </div>
          <div class="form-group">
            <label for="postalCode">کد پستی</label>
            <input type="text" id="postalCode" placeholder="10 رقمی" />
          </div>
          <div class="form-group" id="militaryStatus-group">
            <label for="militaryStatus">وضعیت نظام وظیفه</label>
            <select id="militaryStatus">
              <option value="">--</option>
              <option value="معاف">معاف</option>
              <option value="مشمول">مشمول</option>
              <option value="پایان خدمت">پایان خدمت</option>
              <option value="در حال خدمت">در حال خدمت</option>
            </select>
          </div>
        </div>

        <!-- ردیف 6: اطلاعات پذیرش -->
        <div class="form-row">
          <div class="form-group">
            <label for="admissionType">نوع پذیرش</label>
            <select id="admissionType">
              <option value="با کنکور">با کنکور</option>
              <option value="بدون کنکور">بدون کنکور</option>
              <option value="ظرفیت ویژه">ظرفیت ویژه</option>
            </select>
          </div>
          <div class="form-group">
            <label for="previousDegree">مدرک قبلی</label>
            <select id="previousDegree">
              <option value="دیپلم">دیپلم</option>
              <option value="کاردانی">کاردانی</option>
              <option value="کارشناسی">کارشناسی</option>
              <option value="کارشناسی ارشد">کارشناسی ارشد</option>
            </select>
          </div>
          <div class="form-group">
            <label for="previousMajor">رشته مدرک قبلی</label>
            <input
              type="text"
              id="previousMajor"
              placeholder="رشته دیپلم یا کاردانی"
            />
          </div>
        </div>

        <!-- ردیف 7: اطلاعات مدرک قبلی -->
        <div class="form-row">
          <div class="form-group">
            <label for="graduationYear">سال اخذ مدرک قبلی</label>
            <input type="text" id="graduationYear" placeholder="مثال: 1398" />
          </div>
          <div class="form-group">
            <label for="previousGPA">معدل مدرک قبلی</label>
            <input
              type="number"
              id="previousGPA"
              step="0.01"
              min="0"
              max="20"
              placeholder="بین 0 تا 20"
            />
          </div>
          <div class="form-group">
            <label for="status">وضعیت تحصیلی *</label>
            <select id="status" required>
              <option value="اشتغال به تحصیل">اشتغال به تحصیل</option>
              <option value="فارغ التحصیل">فارغ التحصیل</option>
              <option value="انصراف از تحصیل">انصراف از تحصیل</option>
              <option value="اخراج آموزشی">اخراج آموزشی</option>
              <option value="مهمان">مهمان</option>
              <option value="مرخصی تحصیلی">مرخصی تحصیلی</option>
              <option value="مشروط">مشروط</option>
              <option value="در انتظار ثبت نام">در انتظار ثبت نام</option>
            </select>
          </div>
        </div>

        <!-- آدرس -->
        <div class="form-group">
          <label for="address">آدرس</label>
          <textarea id="address" rows="3" placeholder="آدرس کامل"></textarea>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary" id="submit-btn">
            ثبت دانشجو
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            id="cancel-btn"
            style="display: none"
          >
            انصراف
          </button>
          <button type="button" class="btn btn-danger" id="reset-btn">
            پاک کردن فرم
          </button>
        </div>
      </form>
    </div>

    <div class="table-section">
      <h2>لیست دانشجویان</h2>

      <div class="search-box">
        <input
          type="text"
          id="search-input"
          placeholder="جستجو بر اساس نام، شماره دانشجویی یا رشته..."
        />
      </div>

      <div class="table-container">
        <table id="students-table">
          <thead>
            <tr>
              <th>شماره دانشجویی</th>
              <th>نام</th>
              <th>نام خانوادگی</th>
              <th>کد ملی</th>
              <th>جنسیت</th>
              <th>رشته</th>
              <th>مقطع</th>
              <th>سال ورود</th>
              <th>وضعیت تحصیلی</th>
              <th>تلفن</th>
              <th>وضعیت تاهل</th>
              <th>نوع پذیرش</th>
              <th>عملیات</th>
            </tr>
          </thead>
          <tbody id="students-tbody">
            <!-- Students will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    // Login System
    $("#login-form").on("submit", function (e) {
      e.preventDefault();

      const username = $("#username").val().trim();
      const password = $("#password").val().trim();

      if (username === "admin" && password === "admin") {
        // Login successful
        $("#login-section").hide();
        $("#main-app").show();
        localStorage.setItem("isLoggedIn", "true");
      } else {
        // Login failed
        $("#login-error").show();
        setTimeout(() => {
          $("#login-error").hide();
        }, 3000);
      }
    });

    // Check if user is already logged in
    if (localStorage.getItem("isLoggedIn") === "true") {
      $("#login-section").hide();
      $("#main-app").show();
    }

    // Student Management System
    let students = JSON.parse(localStorage.getItem("students")) || [];
    let isEditMode = false;
    let currentEditId = null;

    // مدیریت وضعیت نظام وظیفه بر اساس جنسیت
    $("#gender").on("change", function () {
      if ($(this).val() === "زن") {
        $("#militaryStatus").val("");
        $("#militaryStatus-group").addClass("hidden");
      } else {
        $("#militaryStatus-group").removeClass("hidden");
      }
    });

    function displayStudents(studentsToShow = students) {
      const tbody = $("#students-tbody");
      tbody.empty();

      if (studentsToShow.length === 0) {
        tbody.html(
          '<tr><td colspan="13" style="text-align: center; padding: 20px; color: #666;">هیچ دانشجویی یافت نشد</td></tr>'
        );
        return;
      }

      studentsToShow.forEach((student) => {
        const statusClass = getStatusClass(student.status);
        const row = `
                        <tr>
                            <td>${student.studentCode}</td>
                            <td>${student.firstName}</td>
                            <td>${student.lastName}</td>
                            <td>${student.nationalId}</td>
                            <td>${student.gender}</td>
                            <td>${student.major}</td>
                            <td>${student.grade}</td>
                            <td>${student.entryYear}</td>
                            <td><span class="status-badge ${statusClass}">${student.status}</span></td>
                            <td>${student.phone}</td>
                            <td>${student.maritalStatus}</td>
                            <td>${student.admissionType}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn btn-warning" onclick="editStudent(${student.id})">ویرایش</button>
                                    <button class="action-btn btn-danger" onclick="deleteStudent(${student.id})">حذف</button>
                                </div>
                            </td>
                        </tr>
                    `;
        tbody.append(row);
      });
    }

    function getStatusClass(status) {
      const statusMap = {
        "اشتغال به تحصیل": "status-active",
        "فارغ التحصیل": "status-graduate",
        "انصراف از تحصیل": "status-dropout",
        "اخراج آموزشی": "status-expelled",
        مهمان: "status-guest",
        "مرخصی تحصیلی": "status-leave",
        مشروط: "status-conditional",
        "در انتظار ثبت نام": "status-pending",
      };
      return statusMap[status] || "status-active";
    }

    function showMessage(message, type = "success") {
      const messageArea = $("#message-area");
      messageArea.html(`<div class="message ${type}">${message}</div>`);

      setTimeout(() => {
        messageArea.empty();
      }, 5000);
    }

    function validateForm(studentData) {
      const requiredFields = [
        "studentCode",
        "nationalId",
        "firstName",
        "lastName",
        "fatherName",
        "major",
        "grade",
        "entryYear",
        "birthDate",
        "phone",
        "status",
        "gender",
      ];

      for (let field of requiredFields) {
        if (!studentData[field]) {
          showMessage(`فیلد ${getFieldLabel(field)} الزامی است`, "error");
          return false;
        }
      }

      if (!isEditMode) {
        const existingStudent = students.find(
          (s) => s.studentCode === studentData.studentCode
        );
        if (existingStudent) {
          showMessage("شماره دانشجویی تکراری است", "error");
          return false;
        }
      }

      if (!/^\d{10}$/.test(studentData.nationalId)) {
        showMessage("کد ملی باید 10 رقمی باشد", "error");
        return false;
      }

      if (!/^09\d{9}$/.test(studentData.phone)) {
        showMessage("شماره تلفن باید 11 رقمی و با 09 شروع شود", "error");
        return false;
      }

      if (
        studentData.email &&
        !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(studentData.email)
      ) {
        showMessage("فرمت ایمیل نامعتبر است", "error");
        return false;
      }

      if (studentData.postalCode && !/^\d{10}$/.test(studentData.postalCode)) {
        showMessage("کد پستی باید 10 رقمی باشد", "error");
        return false;
      }

      return true;
    }

    function getFieldLabel(fieldName) {
      const labels = {
        studentCode: "شماره دانشجویی",
        nationalId: "کد ملی",
        firstName: "نام",
        lastName: "نام خانوادگی",
        fatherName: "نام پدر",
        major: "رشته تحصیلی",
        grade: "مقطع تحصیلی",
        entryYear: "سال ورود",
        birthDate: "تاریخ تولد",
        phone: "شماره تلفن",
        status: "وضعیت تحصیلی",
        gender: "جنسیت",
      };
      return labels[fieldName] || fieldName;
    }

    function saveToLocalStorage() {
      localStorage.setItem("students", JSON.stringify(students));
    }

    $("#student-form").on("submit", function (e) {
      e.preventDefault();

      const studentData = {
        id: isEditMode ? currentEditId : Date.now(),
        studentCode: $("#studentCode").val().trim(),
        nationalId: $("#nationalId").val().trim(),
        firstName: $("#firstName").val().trim(),
        lastName: $("#lastName").val().trim(),
        fatherName: $("#fatherName").val().trim(),
        gender: $("#gender").val(),
        major: $("#major").val(),
        grade: $("#grade").val(),
        entryYear: $("#entryYear").val(),
        birthDate: $("#birthDate").val().trim(),
        email: $("#email").val().trim(),
        phone: $("#phone").val().trim(),
        maritalStatus: $("#maritalStatus").val(),
        postalCode: $("#postalCode").val().trim(),
        militaryStatus: $("#militaryStatus").val(),
        admissionType: $("#admissionType").val(),
        previousDegree: $("#previousDegree").val(),
        previousMajor: $("#previousMajor").val().trim(),
        graduationYear: $("#graduationYear").val().trim(),
        previousGPA: $("#previousGPA").val(),
        status: $("#status").val(),
        address: $("#address").val().trim(),
      };

      if (!validateForm(studentData)) {
        return;
      }

      if (isEditMode) {
        const index = students.findIndex((s) => s.id === currentEditId);
        students[index] = studentData;
        showMessage("اطلاعات دانشجو با موفقیت بروزرسانی شد");
        exitEditMode();
      } else {
        students.push(studentData);
        showMessage("دانشجوی جدید با موفقیت ثبت شد");
      }

      saveToLocalStorage();
      displayStudents();
      this.reset();
      $("#militaryStatus-group").removeClass("hidden");
    });

    $("#reset-btn").on("click", function () {
      $("#student-form")[0].reset();
      exitEditMode();
      $("#militaryStatus-group").removeClass("hidden");
    });

    $("#search-input").on("keyup", function () {
      const searchTerm = $(this).val().toLowerCase();

      if (searchTerm) {
        const filteredStudents = students.filter(
          (student) =>
            student.firstName.toLowerCase().includes(searchTerm) ||
            student.lastName.toLowerCase().includes(searchTerm) ||
            student.studentCode.toLowerCase().includes(searchTerm) ||
            student.major.toLowerCase().includes(searchTerm) ||
            student.nationalId.includes(searchTerm)
        );
        displayStudents(filteredStudents);
      } else {
        displayStudents();
      }
    });

    function exitEditMode() {
      isEditMode = false;
      currentEditId = null;
      $("#form-title").text("فرم ثبت دانشجوی جدید");
      $("#submit-btn").text("ثبت دانشجو");
      $("#cancel-btn").hide();
      $("#student-form")[0].reset();
      $("#militaryStatus-group").removeClass("hidden");
    }

    window.editStudent = function (id) {
      const student = students.find((s) => s.id === id);
      if (student) {
        // پر کردن تمام فیلدها
        $("#student-id").val(student.id);
        $("#studentCode").val(student.studentCode);
        $("#nationalId").val(student.nationalId);
        $("#firstName").val(student.firstName);
        $("#lastName").val(student.lastName);
        $("#fatherName").val(student.fatherName);
        $("#gender").val(student.gender);
        $("#major").val(student.major);
        $("#grade").val(student.grade);
        $("#entryYear").val(student.entryYear);
        $("#birthDate").val(student.birthDate);
        $("#email").val(student.email || "");
        $("#phone").val(student.phone);
        $("#maritalStatus").val(student.maritalStatus || "مجرد");
        $("#postalCode").val(student.postalCode || "");
        $("#militaryStatus").val(student.militaryStatus || "");
        $("#admissionType").val(student.admissionType || "با کنکور");
        $("#previousDegree").val(student.previousDegree || "دیپلم");
        $("#previousMajor").val(student.previousMajor || "");
        $("#graduationYear").val(student.graduationYear || "");
        $("#previousGPA").val(student.previousGPA || "");
        $("#status").val(student.status);
        $("#address").val(student.address || "");

        // مدیریت نمایش وضعیت نظام وظیفه
        if (student.gender === "زن") {
          $("#militaryStatus-group").addClass("hidden");
        } else {
          $("#militaryStatus-group").removeClass("hidden");
        }

        isEditMode = true;
        currentEditId = id;
        $("#form-title").text("فرم ویرایش دانشجو");
        $("#submit-btn").text("بروزرسانی اطلاعات");
        $("#cancel-btn").show();

        $("html, body").animate(
          {
            scrollTop: $(".form-section").offset().top,
          },
          500
        );
      }
    };

    window.deleteStudent = function (id) {
      if (
        confirm("آیا از حذف این دانشجو مطمئن هستید؟ این عمل قابل بازگشت نیست.")
      ) {
        students = students.filter((s) => s.id !== id);
        saveToLocalStorage();
        displayStudents();
        showMessage("دانشجو با موفقیت حذف شد");

        if (isEditMode && currentEditId === id) {
          exitEditMode();
        }
      }
    };

    $("#cancel-btn").on("click", function () {
      exitEditMode();
    });

    // Logout function
    window.logout = function () {
      if (confirm("آیا می‌خواهید از سیستم خارج شوید؟")) {
        localStorage.removeItem("isLoggedIn");
        $("#main-app").hide();
        $("#login-section").show();
        $("#login-form")[0].reset();
      }
    };

    // نمایش اولیه
    if (localStorage.getItem("isLoggedIn") === "true") {
      displayStudents();
    }
  });
</script>

{% endblock %}
